<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Advanced Applications of Simulation | Chan`s Jupyter</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Advanced Applications of Simulation" />
<meta name="author" content="Chanseok Kang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this chapter, students will be introduced to some basic and advanced applications of simulation to solve real-world problems. We’ll work through a business planning problem, learn about Monte Carlo Integration, Power Analysis with simulation and conclude with a financial portfolio simulation. After completing this chapter, students will be ready to apply simulation to solve everyday problems. This is the Summary of lecture “Statistical Simulation in Python”, via datacamp." />
<meta property="og:description" content="In this chapter, students will be introduced to some basic and advanced applications of simulation to solve real-world problems. We’ll work through a business planning problem, learn about Monte Carlo Integration, Power Analysis with simulation and conclude with a financial portfolio simulation. After completing this chapter, students will be ready to apply simulation to solve everyday problems. This is the Summary of lecture “Statistical Simulation in Python”, via datacamp." />
<link rel="canonical" href="https://goodboychan.github.io/chans_jupyter/python/datacamp/statistics/modeling/2020/06/22/02-Advanced-Applications-of-Simulation.html" />
<meta property="og:url" content="https://goodboychan.github.io/chans_jupyter/python/datacamp/statistics/modeling/2020/06/22/02-Advanced-Applications-of-Simulation.html" />
<meta property="og:site_name" content="Chan`s Jupyter" />
<meta property="og:image" content="https://goodboychan.github.io/chans_jupyter/images/power_analysis.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-22T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://goodboychan.github.io/chans_jupyter/python/datacamp/statistics/modeling/2020/06/22/02-Advanced-Applications-of-Simulation.html","@type":"BlogPosting","headline":"Advanced Applications of Simulation","dateModified":"2020-06-22T00:00:00-05:00","datePublished":"2020-06-22T00:00:00-05:00","image":"https://goodboychan.github.io/chans_jupyter/images/power_analysis.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://goodboychan.github.io/chans_jupyter/python/datacamp/statistics/modeling/2020/06/22/02-Advanced-Applications-of-Simulation.html"},"author":{"@type":"Person","name":"Chanseok Kang"},"description":"In this chapter, students will be introduced to some basic and advanced applications of simulation to solve real-world problems. We’ll work through a business planning problem, learn about Monte Carlo Integration, Power Analysis with simulation and conclude with a financial portfolio simulation. After completing this chapter, students will be ready to apply simulation to solve everyday problems. This is the Summary of lecture “Statistical Simulation in Python”, via datacamp.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/chans_jupyter/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://goodboychan.github.io/chans_jupyter/feed.xml" title="Chan`s Jupyter" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-33905785-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/chans_jupyter/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>

<script data-ad-client="ca-pub-6747875619665490" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/chans_jupyter/">Chan`s Jupyter</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/chans_jupyter/about/">About Me</a><a class="page-link" href="/chans_jupyter/search/">Search</a><a class="page-link" href="/chans_jupyter/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Advanced Applications of Simulation</h1><p class="page-description">In this chapter, students will be introduced to some basic and advanced applications of simulation to solve real-world problems. We'll work through a business planning problem, learn about Monte Carlo Integration, Power Analysis with simulation and conclude with a financial portfolio simulation. After completing this chapter, students will be ready to apply simulation to solve everyday problems. This is the Summary of lecture "Statistical Simulation in Python", via datacamp.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-22T00:00:00-05:00" itemprop="datePublished">
        Jun 22, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Chanseok Kang</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      11 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/chans_jupyter/categories/#Python">Python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/chans_jupyter/categories/#Datacamp">Datacamp</a>
        &nbsp;
      
        <a class="category-tags-link" href="/chans_jupyter/categories/#Statistics">Statistics</a>
        &nbsp;
      
        <a class="category-tags-link" href="/chans_jupyter/categories/#Modeling">Modeling</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/goodboychan/chans_jupyter/tree/main/_notebooks/2020-06-22-02-Advanced-Applications-of-Simulation.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/chans_jupyter/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/goodboychan/chans_jupyter/main?filepath=_notebooks%2F2020-06-22-02-Advanced-Applications-of-Simulation.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/chans_jupyter/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/goodboychan/chans_jupyter/blob/main/_notebooks/2020-06-22-02-Advanced-Applications-of-Simulation.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/chans_jupyter/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Simulation-for-Business-Planning">Simulation for Business Planning </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Modeling-Corn-Production">Modeling Corn Production </a></li>
<li class="toc-entry toc-h3"><a href="#Modeling-Profits">Modeling Profits </a></li>
<li class="toc-entry toc-h3"><a href="#Optimizing-Costs">Optimizing Costs </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Monte-Carlo-Integration">Monte Carlo Integration </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Integrating-a-Simple-Function">Integrating a Simple Function </a></li>
<li class="toc-entry toc-h3"><a href="#Calculating-the-value-of-pi">Calculating the value of pi </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Simulation-for-Power-Analysis">Simulation for Power Analysis </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Power-Analysis---Part-I">Power Analysis - Part I </a></li>
<li class="toc-entry toc-h3"><a href="#Power-Analysis---Part-II">Power Analysis - Part II </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Applications-in-Finance">Applications in Finance </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Portfolio-Simulation---Part-I">Portfolio Simulation - Part I </a></li>
<li class="toc-entry toc-h3"><a href="#Portfolio-Simulation---Part-II">Portfolio Simulation - Part II </a></li>
<li class="toc-entry toc-h3"><a href="#Portfolio-Simulation---Part-III">Portfolio Simulation - Part III </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-06-22-02-Advanced-Applications-of-Simulation.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulation-for-Business-Planning">
<a class="anchor" href="#Simulation-for-Business-Planning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simulation for Business Planning<a class="anchor-link" href="#Simulation-for-Business-Planning"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modeling-Corn-Production">
<a class="anchor" href="#Modeling-Corn-Production" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modeling Corn Production<a class="anchor-link" href="#Modeling-Corn-Production"> </a>
</h3>
<p>Suppose that you manage a small corn farm and are interested in optimizing your costs. In this exercise, we will model the production of corn.</p>
<p>For simplicity, let's assume that corn production depends on only two factors: rain, which you don't control, and cost, which you control. Rain is normally distributed with mean 50 and standard deviation 15. For now, let's fix cost at 5,000. Corn produced in any season is a Poisson random variable while the average corn production is governed by the equation:</p>
<p>
$$ 100 * (cost)^{0.1} * (rain)^{0.2} $$

Let's model this production function and simulate one outcome.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>

<span class="c1"># Initialize variables</span>
<span class="n">cost</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">rain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

<span class="c1"># Corn Production Model</span>
<span class="k">def</span> <span class="nf">corn_produced</span><span class="p">(</span><span class="n">rain</span><span class="p">,</span> <span class="n">cost</span><span class="p">):</span>
    <span class="n">mean_corn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">cost</span> <span class="o">**</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">rain</span> <span class="o">**</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">corn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mean_corn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">corn</span>

<span class="c1"># Simulate and print corn production</span>
<span class="n">corn_result</span> <span class="o">=</span> <span class="n">corn_produced</span><span class="p">(</span><span class="n">rain</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Simulated Corn Production = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corn_result</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Simulated Corn Production = 560
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modeling-Profits">
<a class="anchor" href="#Modeling-Profits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modeling Profits<a class="anchor-link" href="#Modeling-Profits"> </a>
</h3>
<p>In the previous exercise, you built a model of corn production. For a small farm, you typically have no control over the price or demand for corn. Suppose that price is normally distributed with mean 40 and standard deviation 10. You are given a function <code>corn_demanded()</code>, which takes the price and determines the demand for corn. This is reasonable because demand is usually determined by the market and is not in your control.</p>
<p>In this exercise, you will work on a function to calculate the profit by pulling together all the other simulated variables. The only input to this function will be the cost. Upon completion, you will have a function that will give you one simulated profit outcome for a given cost. This function can then be used for planning your costs.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">corn_demanded</span><span class="p">(</span><span class="n">price</span><span class="p">):</span>
    <span class="n">mean_corn</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">price</span>
    <span class="n">corn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_corn</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">corn</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>

<span class="c1"># Function to calculate profits</span>
<span class="k">def</span> <span class="nf">profits</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
    <span class="n">rain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">supply</span> <span class="o">=</span> <span class="n">corn_produced</span><span class="p">(</span><span class="n">rain</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
    <span class="n">demand</span> <span class="o">=</span> <span class="n">corn_demanded</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="n">equil_short</span> <span class="o">=</span> <span class="n">supply</span> <span class="o">&lt;=</span> <span class="n">demand</span>
    <span class="k">if</span> <span class="n">equil_short</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">supply</span> <span class="o">*</span> <span class="n">price</span> <span class="o">-</span> <span class="n">cost</span>
        <span class="k">return</span> <span class="n">tmp</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">*</span> <span class="n">price</span> <span class="o">-</span> <span class="n">cost</span>
        <span class="k">return</span> <span class="n">tmp2</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">profits</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Simulated profit = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Simulated profit = 20675.3291075312
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Optimizing-Costs">
<a class="anchor" href="#Optimizing-Costs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optimizing Costs<a class="anchor-link" href="#Optimizing-Costs"> </a>
</h3>
<p>Now we will use the functions you've built to optimize our cost of production. We are interested in maximizing average profits. However, our profits depend on a number of factors, but we only control cost. Thus, we can simulate the uncertainty in the other factors and vary cost to see how our profits are impacted.</p>
<p>Since you manage the small corn farm, you have the ability to choose your cost - from \$100  to \\$5,000. You want to choose the cost that gives you the maximum average profit. In this exercise, we will simulate multiple outcomes for each cost level and calculate an average. We will then choose the cost that gives us the maximum mean profit. Upon completion, you will have a framework for selecting optimal inputs for business decisions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">573</span><span class="p">)</span>

<span class="c1"># Initialize results and cost_levels variables</span>
<span class="n">sims</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">{}</span>
<span class="n">cost_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># For each cost level, simulate profits and store mean profit</span>
<span class="k">for</span> <span class="n">cost</span> <span class="ow">in</span> <span class="n">cost_levels</span><span class="p">:</span>
    <span class="n">tmp_profits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sims</span><span class="p">):</span>
        <span class="n">tmp_profits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profits</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>
    <span class="n">results</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tmp_profits</span><span class="p">)</span>
    
<span class="c1"># Get the cost that maximizes average profit</span>
<span class="n">cost_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">())][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Average profit is maximized when cost = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_max</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/chanseok/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: ComplexWarning: Casting complex values to real discards the imaginary part
  # Remove the CWD from sys.path while we load stuff.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average profit is maximized when cost = 1400
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Monte-Carlo-Integration">
<a class="anchor" href="#Monte-Carlo-Integration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Monte Carlo Integration<a class="anchor-link" href="#Monte-Carlo-Integration"> </a>
</h2>
<ul>
<li>Calculate overall area</li>
<li>Randomly sample points in the area</li>
<li>Multiply the fraction of the points below the curve by overall area.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Integrating-a-Simple-Function">
<a class="anchor" href="#Integrating-a-Simple-Function" aria-hidden="true"><span class="octicon octicon-link"></span></a>Integrating a Simple Function<a class="anchor-link" href="#Integrating-a-Simple-Function"> </a>
</h3>
<p>This is a simple exercise introducing the concept of Monte Carlo Integration.</p>
<p>Here we will evaluate a simple integral $\int_0^1 x e^x dx$. We know that the exact answer is 1, but simulation will give us an approximate solution, so we can expect an answer close to 1. As we saw in the video, it's a simple process. For a function of a single variable $f(x)$:</p>
<ol>
<li>Get the limits of the x-axis ($x_{min},x_{max}$) and y-axis ($max(f(x)),min(min(f(x)),0)$).</li>
<li>Generate a number of uniformly distributed point in this box.</li>
<li>Multiply the area of the box ($(max(f(x)−min(f(x))×(x_{max}−x_{min})$) by the fraction of points that lie below $f(x)$.</li>
</ol>
<p>Upon completion, you will have a framework for handling definite integrals using Monte Carlo Integration.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># Define the sim_integrate function</span>
<span class="k">def</span> <span class="nf">sim_integrate</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">sims</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">sims</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">sims</span><span class="p">)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">area</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">/</span><span class="n">sims</span>
    <span class="k">return</span> <span class="n">result</span>
    
<span class="c1"># Call the sim_integrate function and print results</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">sim_integrate</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sims</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Simulated answer = </span><span class="si">{}</span><span class="s2">, Actual Answer = 1"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Simulated answer = 0.7240166789450252, Actual Answer = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-the-value-of-pi">
<a class="anchor" href="#Calculating-the-value-of-pi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calculating the value of pi<a class="anchor-link" href="#Calculating-the-value-of-pi"> </a>
</h3>
<p>Now we work through a classic example - estimating the value of $\pi$.</p>
<p>Imagine a square of side 2 with the origin $(0,0)$ as its center and the four corners having coordinates $(1,1),(1,−1),(−1,1),(−1,−1)$. The area of this square is $2×2=4$. Now imagine a circle of radius 1 with its center at the origin fitting perfectly inside this square. The area of the circle will be $\pi × \text{radius}^2=\pi$.</p>
<p>To estimate π, we randomly sample multiple points in this square &amp; get the fraction of points inside the circle ($x^2+y^2 \leq 1$). The area of the circle then is 4 times this fraction, which gives us our estimate of $\pi$.</p>
<p>After this exercise, you'll have a grasp of how to use simulation for computation.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># Initialize sims and circle_points</span>
<span class="n">sims</span><span class="p">,</span> <span class="n">circle_points</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">0</span> 

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sims</span><span class="p">):</span>
    <span class="c1"># Generate the two coordinates of a point</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># if the point lies within the unit circle, increment counter</span>
    <span class="n">within_circle</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">within_circle</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">circle_points</span> <span class="o">+=</span><span class="mi">1</span>
        
<span class="c1"># Estimate pi as 4 times the avg number of points in the circle.</span>
<span class="n">pi_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">circle_points</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">sims</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Simulated value of pi = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi_sim</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Simulated value of pi = 3.1468
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulation-for-Power-Analysis">
<a class="anchor" href="#Simulation-for-Power-Analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simulation for Power Analysis<a class="anchor-link" href="#Simulation-for-Power-Analysis"> </a>
</h2>
<ul>
<li>What is power?<ul>
<li>Power = $P(\text{rejecting Null } \vert \text{ true alternative})$</li>
<li>Probability of detecting an effect if it exists</li>
<li>Depends on sample size, $\alpha$ and effect size.</li>
<li>Typically 80% power recommended for $\alpha = 0.05$</li>
</ul>
</li>
<li>Simulation for Power Analysis
<img src="/chans_jupyter/images/copied_from_nb/image/power_analysis.png" alt="power">
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Power-Analysis---Part-I">
<a class="anchor" href="#Power-Analysis---Part-I" aria-hidden="true"><span class="octicon octicon-link"></span></a>Power Analysis - Part I<a class="anchor-link" href="#Power-Analysis---Part-I"> </a>
</h3>
<p>Now we turn to power analysis. You typically want to ensure that any experiment or A/B test you run has at least 80% power. One way to ensure this is to calculate the sample size required to achieve 80% power.</p>
<p>Suppose that you are in charge of a news media website and you are interested in increasing the amount of time users spend on your website. Currently, the time users spend on your website is normally distributed with a mean of 1 minute and a variance of 0.5 minutes. Suppose that you are introducing a feature that loads pages faster and want to know the sample size required to measure a 10% increase in time spent on the website.</p>
<p>In this exercise, we will set up the framework to run one simulation, run a t-test, &amp; calculate the p-value.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># Initialize effect_size, control_mean, control_sd</span>
<span class="n">effect_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">control_mean</span><span class="p">,</span> <span class="n">control_sd</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span>

<span class="c1"># Simulate control_time_spent and treatment_time_spent, assuming equal variance</span>
<span class="n">control_time_spent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">control_mean</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">control_sd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">treatment_time_spent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">control_mean</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">effect_size</span><span class="p">),</span> 
                                        <span class="n">scale</span><span class="o">=</span><span class="n">control_sd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>

<span class="c1"># Run the t-test and get the p_value</span>
<span class="n">t_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">control_time_spent</span><span class="p">,</span> <span class="n">treatment_time_spent</span><span class="p">)</span>
<span class="n">stat_sig</span> <span class="o">=</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"P-value: </span><span class="si">{}</span><span class="s2">, Statistically Significant? </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">,</span> <span class="n">stat_sig</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>P-value: 0.5766409395002308, Statistically Significant? False
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Power-Analysis---Part-II">
<a class="anchor" href="#Power-Analysis---Part-II" aria-hidden="true"><span class="octicon octicon-link"></span></a>Power Analysis - Part II<a class="anchor-link" href="#Power-Analysis---Part-II"> </a>
</h3>
<p>Previously, we simulated one instance of the experiment &amp; generated a p-value. We will now use this framework to calculate statistical power. Power of an experiment is the experiment's ability to detect a difference between treatment &amp; control if the difference really exists. It's good statistical hygiene to strive for 80% power.</p>
<p>For our website, we want to know how many people need to visit each variant, such that we can detect a 10% increase in time spent with 80% power. For this, we start with a small sample (50), simulate multiple instances of this experiment &amp; check power. If 80% power is reached, we stop. If not, we increase the sample size &amp; try again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># Keep incrementing sample size by 10 till we reach required power</span>
<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">control_time_spent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">control_mean</span><span class="p">,</span> 
                                          <span class="n">scale</span><span class="o">=</span><span class="n">control_sd</span><span class="p">,</span> 
                                          <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">sims</span><span class="p">))</span>
    <span class="n">treatment_time_spent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">control_mean</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">effect_size</span><span class="p">),</span> 
                                            <span class="n">scale</span><span class="o">=</span><span class="n">control_sd</span><span class="p">,</span> 
                                            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">sims</span><span class="p">))</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">treatment_time_spent</span><span class="p">,</span> <span class="n">control_time_spent</span><span class="p">)</span>
    
    <span class="c1"># Power is the fraction of times in the simulation when the p-value was less than 0.05</span>
    <span class="n">power</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">sims</span>
    <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span> 
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">sample_size</span> <span class="o">+=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"For 80% power, sample size required = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_size</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>For 80% power, sample size required = 1580
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Applications-in-Finance">
<a class="anchor" href="#Applications-in-Finance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Applications in Finance<a class="anchor-link" href="#Applications-in-Finance"> </a>
</h2>
<ul>
<li>Option &amp; Instrument Pricing</li>
<li>Project Finance</li>
<li>Portfolio Evaluation</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Portfolio-Simulation---Part-I">
<a class="anchor" href="#Portfolio-Simulation---Part-I" aria-hidden="true"><span class="octicon octicon-link"></span></a>Portfolio Simulation - Part I<a class="anchor-link" href="#Portfolio-Simulation---Part-I"> </a>
</h3>
<p>In the next few exercises, you will calculate the expected returns of a stock portfolio &amp; characterize its uncertainty.</p>
<p>Suppose you have invested \$10,000 in your portfolio comprising of multiple stocks. You want to evaluate the portfolio's performance over 10 years. You can tweak your overall expected rate of return and volatility (standard deviation of the rate of return). Assume the rate of return follows a normal distribution.</p>
<p>First, let's write a function that takes the principal (initial investment), number of years, expected rate of return and volatility as inputs and returns the portfolio's total value after 10 years.</p>
<p>Upon completion of this exercise, you will have a function you can call to determine portfolio performance.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">portfolio_return</span><span class="p">(</span><span class="n">yrs</span><span class="p">,</span> <span class="n">avg_return</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span> <span class="n">principal</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
    <span class="n">rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">avg_return</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">yrs</span><span class="p">)</span>
    <span class="c1"># Calculate the return at the end of the period</span>
    <span class="n">end_return</span> <span class="o">=</span> <span class="n">principal</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
        <span class="n">end_return</span> <span class="o">=</span> <span class="n">end_return</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">end_return</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">portfolio_return</span><span class="p">(</span><span class="n">yrs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">avg_return</span> <span class="o">=</span> <span class="mf">0.07</span><span class="p">,</span> <span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">principal</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Portfolio return after 5 years = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Portfolio return after 5 years = 1021.4013412039292
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Portfolio-Simulation---Part-II">
<a class="anchor" href="#Portfolio-Simulation---Part-II" aria-hidden="true"><span class="octicon octicon-link"></span></a>Portfolio Simulation - Part II<a class="anchor-link" href="#Portfolio-Simulation---Part-II"> </a>
</h3>
<p>Now we will use the simulation function you built to evaluate 10-year returns.</p>
<p>Your stock-heavy portfolio has an initial investment of \$10,000, an expected return of 7% and a volatility of 30%. You want to get a 95% confidence interval of what your investment will be worth in 10 years. We will simulate multiple samples of 10-year returns and calculate the confidence intervals on the distribution of returns.</p>
<p>By the end of this exercise, you will have run a complete portfolio simulation.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="c1"># Run 1,000 iterations and store the results</span>
<span class="n">sims</span><span class="p">,</span> <span class="n">rets</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sims</span><span class="p">):</span>
    <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">portfolio_return</span><span class="p">(</span><span class="n">yrs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">avg_return</span> <span class="o">=</span> <span class="mf">0.07</span><span class="p">,</span> 
                                 <span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">principal</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">))</span>

<span class="c1"># Calculate the 95% CI</span>
<span class="n">lower_ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">upper_ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"95% CI of Returns: Lower = </span><span class="si">{}</span><span class="s2">, Upper = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lower_ci</span><span class="p">,</span> <span class="n">upper_ci</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>95% CI of Returns: Lower = 3859.345207073691, Upper = 3859.345207073691
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Portfolio-Simulation---Part-III">
<a class="anchor" href="#Portfolio-Simulation---Part-III" aria-hidden="true"><span class="octicon octicon-link"></span></a>Portfolio Simulation - Part III<a class="anchor-link" href="#Portfolio-Simulation---Part-III"> </a>
</h3>
<p>Previously, we ran a complete simulation to get a distribution for 10-year returns. Now we will use simulation for decision making.</p>
<p>Let's go back to your stock-heavy portfolio with an expected return of 7% and a volatility of 30%. You have the choice of rebalancing your portfolio with some bonds such that the expected return is 4% &amp; volatility is 10%. You have a principal of \$10,000. You want to select a strategy based on how much your portfolio will be worth in 10 years. Let's simulate returns for both the portfolios and choose based on the least amount you can expect with 75% probability (25th percentile).</p>
<p>Upon completion, you will know how to use a portfolio simulation for investment decisions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rets_stock</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rets_bond</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sims</span><span class="p">):</span>
    <span class="n">rets_stock</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">portfolio_return</span><span class="p">(</span><span class="n">yrs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">avg_return</span> <span class="o">=</span> <span class="mf">0.07</span><span class="p">,</span> 
                                       <span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">principal</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">))</span>
    <span class="n">rets_bond</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">portfolio_return</span><span class="p">(</span><span class="n">yrs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">avg_return</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span> 
                                      <span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">principal</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">))</span>

<span class="c1"># Calculate the 25th percentile of the distributions and the amount you'd lose or gain</span>
<span class="n">rets_stock_perc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rets_stock</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">rets_bond_perc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rets_bond</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">additional_returns</span> <span class="o">=</span> <span class="n">rets_stock_perc</span> <span class="o">-</span> <span class="n">rets_bond_perc</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Sticking to stocks gets you an additional return of </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">additional_returns</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Sticking to stocks gets you an additional return of -6696.359667655672
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="goodboychan/chans_jupyter"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/chans_jupyter/python/datacamp/statistics/modeling/2020/06/22/02-Advanced-Applications-of-Simulation.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/chans_jupyter/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/chans_jupyter/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/chans_jupyter/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/goodboychan" title="goodboychan"><svg class="svg-icon grey"><use xlink:href="/chans_jupyter/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/chanseokk" title="chanseokk"><svg class="svg-icon grey"><use xlink:href="/chans_jupyter/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/chans_jupyter/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
